cmake_minimum_required(VERSION 3.1.0)
project(osvrUnityRenderingPlugin)

set(CMAKE_CXX_STANDARD 11)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

#-----------------------------------------------------------------------------
# Local CMake Modules
list(APPEND CMAKE_MODULE_PATH "${CMAKE_CURRENT_SOURCE_DIR}/cmake")


#-----------------------------------------------------------------------------
# This looks for an osvrConfig.cmake file - most of the time it can be
# autodetected but you might need to specify osvr_DIR to be something like
# C:/Users/Ryan/Desktop/build/OSVR-Core-vc12 or
# C:/Users/Ryan/Downloads/OSVR-Core-Snapshot-v0.1-406-gaa55515-build54-vs12-32bit
# in the CMake GUI or command line
find_package(osvr REQUIRED)

# Add one of these libraries for each vendor that we've got a driver
# for and add a No driver that tells that it is unavailable when we
# don't find the driver library.
find_package(OpenGL)
find_package(OpenGLES2 REQUIRED)
find_package(GLEW)
find_package(Boost)
find_package(osvrRenderManager REQUIRED)
find_package(JsonCpp)
find_package(SDL2)

set (osvrUnityRenderingPlugin_SOURCES
    OsvrRenderingPlugin.h
    OsvrRenderingPlugin.cpp
	OsvrUnityRenderer.h
	OsvrAndroidRenderer.cpp
	OsvrAndroidRenderer.h
	OsvrD3DRenderer.cpp
	OsvrD3DRenderer.h
	OsvrOpenGLRenderer.cpp
	OsvrOpenGLRenderer.h
    PluginConfig.h
    UnityRendererType.h
)

if(WIN32)
#    list(APPEND osvrUnityRenderingPlugin_SOURCES OsvrRenderingPlugin.def)
endif()

set(EXTRA_ANDROID_LINKER_FLAGS "")

if(ANDROID)
    add_library(osvrUnityRenderingPlugin SHARED ${osvrUnityRenderingPlugin_SOURCES})
    set(EXTRA_ANDROID_LINKER_FLAGS "log -z global")
else()
    add_library(osvrUnityRenderingPlugin MODULE ${osvrUnityRenderingPlugin_SOURCES})
endif()

#set_target_properties(osvrUnityRenderingPlugin PROPERTIES LINK_FLAGS "/DEF:${CMAKE_CURRENT_SOURCE_DIR}/OsvrRenderingPlugin.def")
#target_link_libraries(osvrUnityRenderingPlugin osvr::osvrClientKit)
#target_link_libraries(osvrUnityRenderingPlugin osvrRenderManager::osvrRenderManager)
target_include_directories(osvrUnityRenderingPlugin PRIVATE ${Boost_INCLUDE_DIRS})
# target_link_libraries(osvrUnityRenderingPlugin ${Boost_LIBRARIES})

if (OPENGL_FOUND AND GLEW_FOUND)
    target_include_directories(osvrUnityRenderingPlugin PRIVATE ${OPENGL_INCLUDE_DIRS})
    target_link_libraries(osvrUnityRenderingPlugin ${OPENGL_LIBRARY} GLEW::GLEW JsonCpp::JsonCpp SDL2::SDL2 osvr::osvrClientKit osvrRenderManager::osvrRenderManager)
    # Handle static glew.
    if(GLEW_LIBRARY MATCHES ".*s.lib")
        target_compile_definitions(osvrUnityRenderingPlugin PRIVATE GLEW_STATIC)
    endif()
endif()
if (OPENGL_FOUND)
    target_include_directories(osvrUnityRenderingPlugin PRIVATE ${OPENGL_INCLUDE_DIRS})
    target_link_libraries(osvrUnityRenderingPlugin ${OPENGL_LIBRARY} JsonCpp::JsonCpp osvr::osvrClientKit osvrRenderManager::osvrRenderManager)
endif()
if(OPENGLES2_FOUND)
    target_include_directories(osvrUnityRenderingPlugin PRIVATE ${OPENGLES2_INCLUDE_DIR})
	target_link_libraries(osvrUnityRenderingPlugin PRIVATE ${OPENGLES2_LIBRARIES} JsonCpp::JsonCpp osvr::osvrClientKit osvrRenderManager::osvrRenderManager android ${EXTRA_ANDROID_LINKER_FLAGS})
endif()

# Install docs, license, sample config
install(TARGETS
    osvrUnityRenderingPlugin
    DESTINATION .)
